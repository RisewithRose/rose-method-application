<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rose Method Application</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #fdf2f8 0%, #f3e8ff 100%);
            min-height: 100vh;
        }
        .step { display: none; }
        .step.active { display: block; }
        .results { display: none; }
        .loading { display: none; }
    </style>
</head>
<body>
    <div class="min-h-screen py-8">
        <div class="max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg">
            
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-rose-600">🌹 Rose Method Application</h1>
                <p class="text-gray-600 mt-2">Consciousness-Based Identity Transformation</p>
            </div>

            <!-- Progress Bar -->
            <div class="mb-8" id="progressSection">
                <div class="flex justify-between text-sm text-gray-600 mb-2">
                    <span>Step <span id="currentStep">1</span> of 5</span>
                    <span><span id="progressPercent">20</span>% Complete</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="progressBar" class="bg-rose-500 h-2 rounded-full transition-all duration-300" style="width: 20%"></div>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loadingSection" class="loading text-center py-16">
                <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-rose-500 mx-auto mb-4"></div>
                <h2 class="text-2xl font-semibold text-gray-800 mb-2">Analyzing Your Application...</h2>
                <p class="text-gray-600">Our AI is reviewing your responses and determining the best path for your transformation journey.</p>
            </div>

            <!-- Application Form -->
            <form id="applicationForm">
                
                <!-- Step 1: Personal Information -->
                <div class="step active bg-gray-50 rounded-lg p-6 mb-6" data-step="1">
                    <h2 class="text-xl font-semibold mb-4">Personal Information</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Full Name *</label>
                            <input type="text" name="name" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500" placeholder="Your full name">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Email Address *</label>
                            <input type="email" name="email" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500" placeholder="your@email.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Phone Number *</label>
                            <input type="tel" name="phone" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500" placeholder="Your phone number">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Time Zone *</label>
                            <select name="timeZone" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500">
                                <option value="">Select time zone</option>
                                <option value="EST">Eastern Time (EST)</option>
                                <option value="CST">Central Time (CST)</option>
                                <option value="MST">Mountain Time (MST)</option>
                                <option value="PST">Pacific Time (PST)</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Assessment & Readiness -->
                <div class="step bg-gray-50 rounded-lg p-6 mb-6" data-step="2">
                    <h2 class="text-xl font-semibold mb-4">Assessment & Readiness</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Assessment Score *</label>
                            <input type="text" name="assessmentScore" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500" placeholder="e.g., 85/120">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">What specifically drew you to the Rose Method? *</label>
                            <textarea name="drawnToRoseMethod" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500 h-24" placeholder="Describe what appeals to you about this consciousness-based approach..."></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Recent growth edge example *</label>
                            <textarea name="growthExample" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500 h-24" placeholder="Share a specific example of your growth capability..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Program Logistics -->
                <div class="step bg-gray-50 rounded-lg p-6 mb-6" data-step="3">
                    <h2 class="text-xl font-semibold mb-4">Program Logistics</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Weekly session availability *</label>
                            <select name="weeklyCommitment" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500">
                                <option value="">Select your availability</option>
                                <option value="Yes, fully available">Yes, fully available for weekly sessions</option>
                                <option value="Yes, with flexibility">Yes, with some scheduling flexibility needed</option>
                                <option value="Uncertain">Uncertain about time commitment</option>
                                <option value="No">No, significant scheduling conflicts</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Daily practice commitment *</label>
                            <select name="dailyPractice" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500">
                                <option value="">Select your commitment level</option>
                                <option value="Yes, excited">Yes, excited about daily practice</option>
                                <option value="Yes, can commit">Yes, can commit but concerned about consistency</option>
                                <option value="Uncertain">Uncertain about daily commitment</option>
                                <option value="Cannot commit">Cannot commit to daily practice</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Private space for voice work *</label>
                            <select name="privateSpace" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500">
                                <option value="">Select your space situation</option>
                                <option value="Yes, dedicated space">Yes, I have a dedicated private space</option>
                                <option value="Yes, can arrange">Yes, I can arrange private time/space</option>
                                <option value="Limited privacy">Limited privacy but can work with it</option>
                                <option value="No private space">No, lack of private space</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Investment Readiness -->
                <div class="step bg-gray-50 rounded-lg p-6 mb-6" data-step="4">
                    <h2 class="text-xl font-semibold mb-4">Investment Readiness</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Financial investment readiness *</label>
                            <textarea name="investmentReadiness" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500 h-24" placeholder="Share your perspective on investing in your transformation..."></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Value of successful completion *</label>
                            <textarea name="transformationValue" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500 h-24" placeholder="Describe the value this transformation would create in your life..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Voice Work & Final Questions -->
                <div class="step bg-gray-50 rounded-lg p-6 mb-6" data-step="5">
                    <h2 class="text-xl font-semibold mb-4">Voice Work & Final Questions</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Voice recording comfort level *</label>
                            <select name="recordingComfort" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500">
                                <option value="">Select your comfort level</option>
                                <option value="Very comfortable">Very comfortable, excited about voice work</option>
                                <option value="Somewhat comfortable">Somewhat comfortable, willing to try</option>
                                <option value="Nervous but open">Nervous but open to voice recording</option>
                                <option value="Very uncomfortable">Very uncomfortable with voice work</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Biggest hope for transformation *</label>
                            <textarea name="biggestHope" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500 h-20" placeholder="What do you most hope to achieve or become?"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Biggest fear about transformation *</label>
                            <textarea name="biggestFear" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500 h-20" placeholder="What concerns or fears do you have about this journey?"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Additional information (Optional)</label>
                            <textarea name="additionalInfo" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500 h-20" placeholder="Anything else you'd like to share..."></textarea>
                        </div>
                    </div>
                </div>

            </form>

            <!-- Navigation -->
            <div id="navigationSection" class="flex justify-between">
                <button id="prevBtn" class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-colors" disabled>Previous</button>
                <button id="nextBtn" class="px-6 py-3 bg-rose-500 text-white rounded-lg hover:bg-rose-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-semibold">Next</button>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="results">
                <div id="resultsContent" class="rounded-lg border-2 p-6">
                    <!-- Results will be populated here -->
                </div>
            </div>

            <div class="mt-8 text-center text-sm text-gray-500">
                <p>Upon submission, you'll receive an instant AI-powered review of your application with personalized recommendations.</p>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 5;

        function updateProgress() {
            const progressPercent = (currentStep / totalSteps) * 100;
            document.getElementById('currentStep').textContent = currentStep;
            document.getElementById('progressPercent').textContent = Math.round(progressPercent);
            document.getElementById('progressBar').style.width = progressPercent + '%';
        }

        function showStep(step) {
            // Hide all steps
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            
            // Show current step
            document.querySelector(`[data-step="${step}"]`).classList.add('active');
            
            // Update navigation
            document.getElementById('prevBtn').disabled = step === 1;
            document.getElementById('nextBtn').textContent = step === totalSteps ? 'Submit Application' : 'Next';
            
            updateProgress();
        }

        function isStepValid(step) {
            const stepElement = document.querySelector(`[data-step="${step}"]`);
            const requiredInputs = stepElement.querySelectorAll('[required]');
            
            for (let input of requiredInputs) {
                if (!input.value.trim()) {
                    return false;
                }
            }
            return true;
        }

        function nextStep() {
            if (currentStep === totalSteps) {
                submitApplication();
                return;
            }

            if (isStepValid(currentStep)) {
                currentStep++;
                showStep(currentStep);
            } else {
                alert('Please fill in all required fields before continuing.');
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }

        async function submitApplication() {
            const formData = new FormData(document.getElementById('applicationForm'));
            const data = Object.fromEntries(formData.entries());

            // Show loading
            document.getElementById('applicationForm').style.display = 'none';
            document.getElementById('navigationSection').style.display = 'none';
            document.getElementById('progressSection').style.display = 'none';
            document.getElementById('loadingSection').style.display = 'block';

            const prompt = `You are an expert Rose Method application reviewer. The Rose Method is a consciousness-based transformation program using AI Oracle prophetic fiction and voice embodiment for identity creation (not healing/therapy).

APPLICANT INFORMATION:
- Name: ${data.name}
- Email: ${data.email}
- Assessment Score: ${data.assessmentScore}/120 (80+ is Rose Method ready)
- What drew them: ${data.drawnToRoseMethod}
- Growth example: ${data.growthExample}
- Weekly commitment: ${data.weeklyCommitment}
- Daily practice: ${data.dailyPractice}
- Private space: ${data.privateSpace}
- Investment readiness: ${data.investmentReadiness}
- Transformation value: ${data.transformationValue}
- Recording comfort: ${data.recordingComfort}
- Biggest hope: ${data.biggestHope}
- Biggest fear: ${data.biggestFear}
- Additional info: ${data.additionalInfo}

REVIEW CRITERIA:
1. Readiness Alignment (25 points): Growth-oriented vs crisis/healing focused
2. Practical Commitment (25 points): Time, space, and consistency capability
3. Voice Embodiment Readiness (25 points): Comfort with vocal transformation work
4. Investment Alignment (25 points): Understanding of program value and commitment

Provide a JSON response with this exact structure:
{
  "recommendation": "ACCEPT" | "ACCEPT_WITH_CONDITIONS" | "WAITLIST" | "REFER_TO_LED_BY_LOVE",
  "totalScore": number (0-100),
  "scores": {
    "readinessAlignment": number (0-25),
    "practicalCommitment": number (0-25),
    "voiceReadiness": number (0-25),
    "investmentAlignment": number (0-25)
  },
  "strengths": ["strength1", "strength2", "strength3"],
  "concerns": ["concern1", "concern2"],
  "conditions": ["condition1", "condition2"] | null,
  "reasoning": "Brief explanation of recommendation",
  "nextSteps": "Specific guidance for applicant",
  "estimatedSuccess": number (0-100)
}

Focus on growth readiness over healing needs. Be encouraging but honest.`;

            try {
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 1000,
                        messages: [
                            { role: "user", content: prompt }
                        ]
                    })
                });

                const responseData = await response.json();
                const claudeResponse = responseData.content[0].text;
                
                let reviewData;
                try {
                    const cleanedResponse = claudeResponse.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
                    reviewData = JSON.parse(cleanedResponse);
                } catch (parseError) {
                    reviewData = {
                        recommendation: "MANUAL_REVIEW_NEEDED",
                        totalScore: 0,
                        reasoning: "Technical error - application will be reviewed manually within 24 hours",
                        nextSteps: "We'll email you within 24 hours with your review results."
                    };
                }
                
                showResults(reviewData);
                
            } catch (error) {
                console.error("Error during application review:", error);
                showResults({
                    recommendation: "MANUAL_REVIEW_NEEDED",
                    totalScore: 0,
                    reasoning: "Technical error - application will be reviewed manually",
                    nextSteps: "We'll email you within 24 hours with your review results."
                });
            }
        }

        function showResults(review) {
            document.getElementById('loadingSection').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'block';

            const colors = {
                'ACCEPT': 'bg-green-100 border-green-500 text-green-800',
                'ACCEPT_WITH_CONDITIONS': 'bg-blue-100 border-blue-500 text-blue-800',
                'WAITLIST': 'bg-yellow-100 border-yellow-500 text-yellow-800',
                'REFER_TO_LED_BY_LOVE': 'bg-orange-100 border-orange-500 text-orange-800',
                'default': 'bg-gray-100 border-gray-500 text-gray-800'
            };

            const titles = {
                'ACCEPT': '🎉 CONGRATULATIONS - YOU\'RE ACCEPTED!',
                'ACCEPT_WITH_CONDITIONS': '✨ ACCEPTED with Conditions',
                'WAITLIST': '📋 WAITLISTED for Future Consideration',
                'REFER_TO_LED_BY_LOVE': '💝 REFERRED to Led by Love Program',
                'default': '🔍 MANUAL REVIEW NEEDED'
            };

            const colorClass = colors[review.recommendation] || colors.default;
            const title = titles[review.recommendation] || titles.default;

            let scoresHtml = '';
            if (review.scores) {
                scoresHtml = `
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="text-center bg-white bg-opacity-50 rounded-lg p-3">
                            <div class="font-semibold text-sm">Readiness</div>
                            <div class="text-xl font-bold">${review.scores.readinessAlignment}/25</div>
                        </div>
                        <div class="text-center bg-white bg-opacity-50 rounded-lg p-3">
                            <div class="font-semibold text-sm">Commitment</div>
                            <div class="text-xl font-bold">${review.scores.practicalCommitment}/25</div>
                        </div>
                        <div class="text-center bg-white bg-opacity-50 rounded-lg p-3">
                            <div class="font-semibold text-sm">Voice Ready</div>
                            <div class="text-xl font-bold">${review.scores.voiceReadiness}/25</div>
                        </div>
                        <div class="text-center bg-white bg-opacity-50 rounded-lg p-3">
                            <div class="font-semibold text-sm">Investment</div>
                            <div class="text-xl font-bold">${review.scores.investmentAlignment}/25</div>
                        </div>
                    </div>
                `;
            }

            let strengthsHtml = '';
            if (review.strengths && review.strengths.length > 0) {
                strengthsHtml = `
                    <div class="mb-4">
                        <h3 class="font-semibold text-lg mb-2">Your Strengths</h3>
                        <ul class="list-disc pl-5 space-y-1">
                            ${review.strengths.map(strength => `<li>${strength}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            let concernsHtml = '';
            if (review.concerns && review.concerns.length > 0) {
                concernsHtml = `
                    <div class="mb-4">
                        <h3 class="font-semibold text-lg mb-2">Areas for Consideration</h3>
                        <ul class="list-disc pl-5 space-y-1">
                            ${review.concerns.map(concern => `<li>${concern}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            let nextStepsHtml = '';
            if (review.recommendation === 'ACCEPT') {
                nextStepsHtml = `
                    <div class="mt-8 text-center bg-white bg-opacity-70 rounded-lg p-4">
                        <h3 class="font-semibold mb-2">🎯 Ready to Begin Your Transformation?</h3>
                        <p class="mb-4">Schedule your strategy call to customize your Rose Method journey</p>
                        <button class="bg-rose-600 text-white px-6 py-3 rounded-lg hover:bg-rose-700 transition-colors font-semibold">
                            Schedule Strategy Call
                        </button>
                    </div>
                `;
            } else if (review.recommendation === 'REFER_TO_LED_BY_LOVE') {
                nextStepsHtml = `
                    <div class="mt-8 text-center bg-white bg-opacity-70 rounded-lg p-4">
                        <h3 class="font-semibold mb-2">💝 Start Your Foundation Journey</h3>
                        <p class="mb-4">Led by Love will build the perfect foundation for your future Rose Method experience</p>
                        <button class="bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition-colors font-semibold">
                            Apply for Led by Love
                        </button>
                    </div>
                `;
            }

            document.getElementById('resultsContent').className = `rounded-lg border-2 p-6 ${colorClass}`;
            document.getElementById('resultsContent').innerHTML = `
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold mb-2">${title}</h2>
                    <p class="text-lg">Overall Review Score: ${review.totalScore}/100</p>
                </div>

                ${scoresHtml}

                <div class="space-y-4">
                    <div>
                        <h3 class="font-semibold text-lg mb-2">Review Summary</h3>
                        <p class="leading-relaxed">${review.reasoning}</p>
                    </div>

                    ${strengthsHtml}
                    ${concernsHtml}

                    <div>
                        <h3 class="font-semibold text-lg mb-2">Your Next Steps</h3>
                        <p class="leading-relaxed">${review.nextSteps}</p>
                    </div>

                    ${review.estimatedSuccess ? `
                        <div class="text-center bg-white bg-opacity-50 rounded-lg p-4">
                            <div class="font-semibold">Estimated Success Probability</div>
                            <div class="text-3xl font-bold">${review.estimatedSuccess}%</div>
                        </div>
                    ` : ''}
                </div>

                ${nextStepsHtml}

                <div class="mt-6 text-center text-sm opacity-75">
                    <p>This review was generated instantly using advanced AI analysis. You'll receive a follow-up email within 24 hours with additional details.</p>
                </div>
            `;
        }

        // Event listeners
        document.getElementById('nextBtn').addEventListener('click', nextStep);
        document.getElementById('prevBtn').addEventListener('click', prevStep);

        // Initialize
        showStep(1);
    </script>
</body>
</html>
